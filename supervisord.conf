[supervisord]
nodaemon=true
logfile=/app/logs/supervisord.log
pidfile=/app/supervisord.pid
loglevel=info

# ----------------------------------------------------------------
# 1. THE API (Control Plane)
# Must start first to serve health checks and dashboard
# ----------------------------------------------------------------
[program:api]
command=uvicorn main:app --host 0.0.0.0 --port 8000
directory=/app
autostart=true
autorestart=true
# Log Rotation (Prevents Disk Crash)
stdout_logfile=/app/logs/api.out.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5
stderr_logfile=/app/logs/api.err.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=5

# ----------------------------------------------------------------
# 2. THE ENGINE (Trading Core)
# The heart of the system.
# ----------------------------------------------------------------
[program:engine]
command=python core/engine.py
directory=/app
autostart=true
autorestart=true
# Wait 5 seconds for API/DB to settle before starting
startsecs=5
# Log Rotation
stdout_logfile=/app/logs/engine.out.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5
stderr_logfile=/app/logs/engine.err.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=5

# ----------------------------------------------------------------
# 3. THE SHERIFF (Risk Watchdog) - CRITICAL
# Independent process. If this dies, we are flying blind.
# ----------------------------------------------------------------
[program:sheriff]
command=python services/risk_watchdog.py
directory=/app
autostart=true
autorestart=true
startsecs=10
# Log Rotation
stdout_logfile=/app/logs/sheriff.out.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5
stderr_logfile=/app/logs/sheriff.err.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=5

# ----------------------------------------------------------------
# 4. THE SENTINEL (Telegram Alerts)
# Watches the Sheriff. Alerts human if Sheriff dies.
# ----------------------------------------------------------------
[program:sentinel]
command=python services/telegram_bot.py
directory=/app
autostart=true
autorestart=true
startsecs=15
# Log Rotation
stdout_logfile=/app/logs/sentinel.out.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile=/app/logs/sentinel.err.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=3

# ----------------------------------------------------------------
# 5. THE ANALYST (AI Brain)
# Runs asynchronously. Non-critical for immediate safety.
# ----------------------------------------------------------------
[program:analyst]
command=python services/ai_analyst.py
directory=/app
autostart=true
autorestart=true
# Log Rotation
stdout_logfile=/app/logs/analyst.out.log
stdout_logfile_maxbytes=20MB
stdout_logfile_backups=3
stderr_logfile=/app/logs/analyst.err.log
stderr_logfile_maxbytes=20MB
stderr_logfile_backups=3
