[supervisord]
nodaemon=true
logfile=/app/logs/supervisord.log
pidfile=/app/supervisord.pid
loglevel=info

# ----------------------------------------------------------------
# 1. THE API (Control Plane)
# Must start first to serve health checks and dashboard
# ----------------------------------------------------------------
[program:api]
command=uvicorn main:app --host 0.0.0.0 --port 8000
directory=/app
autostart=true
autorestart=true
stderr_logfile=/app/logs/api.err.log
stdout_logfile=/app/logs/api.out.log

# ----------------------------------------------------------------
# 2. THE ENGINE (Trading Core)
# The heart of the system. Writes PID file for Sheriff to track.
# ----------------------------------------------------------------
[program:engine]
command=python core/engine.py
directory=/app
autostart=true
autorestart=true
stderr_logfile=/app/logs/engine.err.log
stdout_logfile=/app/logs/engine.out.log
# Wait 5 seconds for API/DB to settle before starting
startsecs=5

# ----------------------------------------------------------------
# 3. THE SHERIFF (Risk Watchdog) - CRITICAL
# Independent process. If this dies, we are flying blind.
# ----------------------------------------------------------------
[program:sheriff]
command=python services/risk_watchdog.py
directory=/app
autostart=true
autorestart=true
stderr_logfile=/app/logs/sheriff.err.log
stdout_logfile=/app/logs/sheriff.out.log
# Start after Engine so it can find the PID file
startsecs=10

# ----------------------------------------------------------------
# 4. THE ANALYST (AI Brain)
# Runs asynchronously. Non-critical for immediate safety.
# ----------------------------------------------------------------
[program:analyst]
command=python services/ai_analyst.py
directory=/app
autostart=true
autorestart=true
stderr_logfile=/app/logs/analyst.err.log
stdout_logfile=/app/logs/analyst.out.log
